<div class="container">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="text-center">
        <div class="row mx-auto text-center align-content-center">
          <div class="col-xl-9 col-md-10 col-sm-12 mx-auto text-center">
            <div class="card container">
              <div class="card-body">
                <h5 class="card-title">
                  Get Cultivar Reviews
                </h5>
                <form method="POST" action="/get-review">
                  <div class="row text-start align-content-start">
                    <label class="form-label">
                      Cultivator
                    </label>
                  </div>
                  <div class="row">
                    <select 
                      class="form-select form-select-lg mb-3"
                      id="cultivator_selected" 
                      name="cultivator_selected" 
                      aria-label=".form-select-lg cultivator_selected"
                    >
                    </select>
                  </div>
                  <div class="row text-start align-content-start">
                    <label class="form-label">
                      Strain
                    </label>
                  </div>
                  <div class="row">
                    <select 
                      class="form-select form-select-lg mb-3"
                      id="strain_selected" 
                      name="strain_selected" 
                      aria-label=".form-select-lg strain_selected"
                    >
                    </select>
                  </div>
                  <div class="row pt-3 pb-3">
                    <button 
                      class="btn btn-info"
                      id="submit"
                      type="submit" 
                      value="Submit"
                    >
                      Submit
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% block scripts %}
  <script>
    window.addEventListener('DOMContentLoaded', function() {
      var strainSelect = document.getElementById('strain_selected');
      var cultivatorSelect = document.getElementById('cultivator_selected');
      var submitButton = document.getElementById('submit');
    
      function updateButtonState() {
        submitButton.disabled = !(strainSelect.value && cultivatorSelect.value);
      }
    
      var initialLoad = !localStorage.getItem('selectedCultivator');
    
      fetch('/get-all-cultivators')
        .then(response => response.json())
        .then(data => {
          var selectedCultivator = initialLoad ? data[0] : localStorage.getItem('selectedCultivator');
          data.forEach(function(cultivator) {
            var option = document.createElement('option');
            option.text = cultivator;
            option.value = cultivator;
            if (cultivator === selectedCultivator) {
              option.selected = true;
            }
            cultivatorSelect.add(option);
          });
    
          var event = new Event('change');
          cultivatorSelect.dispatchEvent(event);
        });
    
      cultivatorSelect.addEventListener('change', function(e) {
        var cultivatorSelected = e.target.value;
        localStorage.setItem('selectedCultivator', cultivatorSelected);
    
        fetch('/get-strains-for-cultivator?cultivator_selected=' + cultivatorSelected)
          .then(response => response.json())
          .then(data => {
            strainSelect.innerHTML = '';
            var selectedStrain = initialLoad ? data[0] : localStorage.getItem('selectedStrain');
            data.forEach(function(strain) {
              var option = document.createElement('option');
              option.text = strain;
              option.value = strain;
              if (strain === selectedStrain) {
                option.selected = true;
              }
              strainSelect.add(option);
            });
            updateButtonState();
          });
      });
    
      strainSelect.addEventListener('change', function(e) {
        localStorage.setItem('selectedStrain', e.target.value);
        updateButtonState();
      });
    
      cultivatorSelect.addEventListener('change', updateButtonState);
      strainSelect.addEventListener('change', updateButtonState);
    
      updateButtonState();
    });
  </script>
{% endblock %}