<!-- Modal Structure Template -->
<div class="modal fade w-100" id="questionModal" tabindex="-1" aria-labelledby="questionModalLabel" aria-hidden="true" style="min-width:100%">
  <div class="modal-dialog modal-dialog-centered w-100">
    <div class="modal-content overflow-auto">
      <form method="POST" action="/myster_flower_review/submit-mystery-review" id="submit-mystery-vote" name="submit-mystery-vote">
        <div class="container text-center pt-1 pb-1">
          <div class="row align-content-center justify-content-center pt-4">
              <u><h5 class="modal-title fs-3" id="modalTitle">Question</h5></u>
          </div>
          <div class="container text-center align-content-center align-items-center justify-content-center w-100 px-0 pt-2 pb-0">
            <div class="col-12 justify-content-center text-center p-0">
              <div class="modal-body text-center align-content-center justify-content-center pb-2 px-0 mx-0" id="modalBody">
                <!-- Dynamic Content will be loaded here -->
              </div>
            </div>
          </div>
          <div class="container"> 
            <div class="col-12">
              <div class="row justify-content-center pt-4 px-4">
                <div class="col-6">
                  <button type="button" class="btn btn-lg btn-error w-100" style="border: 2px solid black;" id="backBtn">Back</button>
                </div>
                <div class="col-6">
                  <button type="button" class="btn btn-lg btn-info w-100" style="border: 2px solid black;" id="nextBtn" name="nextBtn">Next</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row justify-content-center">
            <div class="col-4 col-md-5 col-6">
              <img class="img-fluid" src="https://tahksrvuvfznfytctdsl.supabase.co/storage/v1/object/sign/cannabiscult/card_assets/Cult%20Classic%20%20Cultivar%20Emblem.svg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1cmwiOiJjYW5uYWJpc2N1bHQvY2FyZF9hc3NldHMvQ3VsdCBDbGFzc2ljICBDdWx0aXZhciBFbWJsZW0uc3ZnIiwiaWF0IjoxNjk1MDkzODQyLCJleHAiOjE3MjY2Mjk4NDJ9.57R00NLb_38ruDIIHbdKNskRCcadnv3gW8BJstVSpHI&t=2023-09-19T03%3A24%3A02.520Z" />
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Voter Info Capture Modal -->
<div class="modal fade" id="voterInfoCaptureModal" tabindex="-1" aria-labelledby="voterInfoCaptureModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="voterInfoCaptureModalLabel">New Connoisseur Information</h5>
      </div>
      <div class="modal-body">
        <form id="newVoterForm">
          <div class="mb-3">
            <label for="newVoterName" class="form-label">Name</label>
            <input type="text" class="form-control" id="voter_name" name="voter_name" autocomplete="name">
          </div>
          <div class="mb-3">
            <label for="newVoterEmail" class="form-label">Email</label>
            <input type="email" class="form-control email-input-field" id="voter_email" name="voter_email" autocomplete="email" required>
          </div>
          <div class="mb-3">
            <label for="newVoterPhone" class="form-label">Phone</label>
            <input type="text" class="form-control" id="voter_phone" name="voter_phone" autocomplete="phone">
          </div>
          <div class="mb-3">
            <label for="newVoterZipCode" class="form-label">Zip Code</label>
            <input type="text" class="form-control" id="voter_zip_code" name="voter_zip_code" autocomplete="on">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <div class="row g-2 p-1">
          <div class="col-6 align-items-start">
            <button type="button" class="btn btn-error" id="newUserBackBtn">Back</button>
          </div>
          <div class="col-6 align-items-end">
            <button type="button" class="btn btn-info" id="submitNewVoterBtn">Submit</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% block scripts %}  
<script>
  const questions = [
    {
      title: "Connoisseur Email",
      content: `
        <div class="container">
          <div class="row px-4 py-2 py-lg-3">
            <input class="form-control text-center email-input-field" id="voter_email" name="voter_email" placeholder="Your email is required to rate strains" />
         </div>
        </div>`,
      key: "voter_email"
    },
    {
      title: "Method of Consumption for {{ strain }}",
      content: `
        <div class="container ps-lg-3">
          <div class="row align-items-center justify-content-center g-1">
            <div class="col-auto d-flex align-items-center text-start">
              <label class="pe-3 consume-label" for="method_of_consumption">How did you consume {{ strain }}:</label>
            </div>
            <div class="col-auto d-flex align-items-center text-start"> 
              <div class="single-width-outline">
                <select class="form-select ps-2 pe-2" id="method_of_consumption" name="method_of_consumption" aria-label="Method of Consumption Dropdown Field">
                  <option value="blunt">Blunt</option>
                  <option value="bong">Bong</option>
                  <option value="joint">Joint</option>
                  <option value="one_hitter">One-Hitter</option>
                  <option value="pipe">Pipe</option>
                  <option value="steamroller">Steamroller</option>
                  <option value="vaporizer">Vaporizer</option>
                  <option value="other">Other</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      `,
      key: "method_of_consumption"
    },
    {
      title: "{{ strain }} - Bud Size Rating",
      content: `
        <div class="container">
          <div class="btn-group" role="group" aria-label="Connoisseur Sight Vote">
            <input type="radio" class="btn-check btn-outline-dark" name="mystery_size_vote" id="mystery_size_vote1" value="1" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote1" id="sight_1_point">1</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote2" value="2" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote2">2</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote3" value="3" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote3">3</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote4" value="4" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote4">4</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote5" value="5" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote5">5</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote6" value="6" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote6">6</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote7" value="7" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote7">7</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote8" value="8" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote8">8</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote9" value="9" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote9">9</label>
          
            <input type="radio" class="btn-check" name="mystery_size_vote" id="mystery_size_vote10" value="10" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_size_vote10" id="size_10_point">10</label>
          </div>
          <div class="row pt-1">
            <div class="col text-start">
              <label class="ps-2  modal-info-shadow" for="size_1_point">Small Buds</label> 
            </div>
            <div class="col text-end">
              <label class="pe-2  modal-info-shadow" for="size_10_point">Single Bud</label> 
            </div>
          </div>
        </div>
      `,
      key: "mystery_size_vote"
    },
    {
      title: "{{ strain }} - Bud Size Rating Explation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_size_explanation" name="mystery_size_explanation" placeholder="Explain your Bud Size rating for {{ strain }}" aria-label="Size Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_size_explanation"
    },
    {
      title: "{{ strain }} - Bud Appearance Rating",
      content: `
        <div class="container align-items-center text-center">
          <div class="btn-group" role="group" aria-label="Connoisseur Sight Vote">
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote1" value="1" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote1" id="sight_1_point">1</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote2" value="2" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote2">2</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote3" value="3" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote3">3</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote4" value="4" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote4">4</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote5" value="5" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote5">5</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote6" value="6" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote6">6</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote7" value="7" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote7">7</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote8" value="8" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote8">8</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote9" value="9" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote9">9</label>
          
            <input type="radio" class="btn-check" name="mystery_sight_vote" id="mystery_sight_vote10" value="10" autocomplete="off">
            <label class="btn btn-outline-dark" for="mystery_sight_vote10" id="sight_10_point">10</label>
          </div>
          <div class="row pt-1">
            <div class="col text-start">
              <label class="ps-2 modal-info-shadow long-voting-label" for="sight_1_point">Bad Color, Few Trichomes</label> 
            </div>
            <div class="col text-end">
              <label class="pe-2 modal-info-shadow long-voting-label" for="sight_10_point">Rich Color & Trichomes</label> 
            </div>
          </div>
        </div>
      `,
      key: "mystery_sight_vote"
    },
    {
      title: "{{ strain }} - Eye Appeal Rating Explation",
      content: `
        <div class="container">
          <div class="row px-3">
            <input class="form-control text-center" type="text" id="mystery_sight_explanation" name="mystery_sight_explanation" placeholder="Explain your Bud Appearance rating for {{ strain }}" aria-label="Sight Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_sight_explanation"
    },
    {
      title: "{{ strain }} - Buds Structure Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Bud Structure Rating">
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote1" id="structure_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_structure_vote" id="mystery_structure_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_structure_vote10" id="structure_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col text-start">
            <label class="ps-2 modal-info-shadow long-voting-label" for="structure_1_point">Larfy, Stemmy, Leafy</label> 
          </div>
          <div class="col text-end">
            <label class="pe-2 modal-info-shadow long-voting-label" for="structure_10_point">Dense, Clean Trim</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_structure_vote"
    },
    {
      title: "{{ strain }} - Bud Structure Rating Explanation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_structure_explanation" name="mystery_structure_explanation" placeholder="Explain your Bud Structure Rating for {{ strain }}" aria-label="Structure Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_structure_explanation"
    },
    {
      title: "{{ strain }} - Aroma Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Smell Vote">
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote1" id="smell_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_smell_vote" id="mystery_smell_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smell_vote10" id="smell_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col text-start">
            <label class="ps-2 modal-info-shadow" for="smell_1_point">Bad<span class="long-voting-label"> or </span>No Aroma</label> 
          </div>
          <div class="col text-end">
            <label class="pe-2 modal-info-shadow" for="smell_10_point">Good, Strong Aroma</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_smell_vote"
    },
    {
      title: "{{ strain }} - Aroma Rating Explanation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_smell_explanation" name="mystery_smell_explanation" placeholder="Explain your Aroma Rating for {{ strain }}" aria-label="Smell Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_smell_explanation"
    },
    {
      title: "{{ strain }} - Stickiness & Moisture Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Freshness Vote">
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote1" id="freshness_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_freshness_vote" id="mystery_freshness_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_freshness_vote10" id="freshness_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col text-start">
            <label class="ps-2 modal-info-shadow" for="freshness_1_point">Dry & Dusty</label> 
          </div>
          <div class="col text-end">
            <label class="pe-2 modal-info-shadow" for="freshness_10_point">Dank & Sticky</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_freshness_vote"
    },
    {
      title: "{{ strain }} - Stickiness & Moisture Rating Explanation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_freshness_explanation" name="mystery_freshness_explanation" placeholder="Explain your Stickiness Rating for {{ strain }}" aria-label="Freshness Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_freshness_explanation"
    },
    {
      title: "{{ strain }} - Flavor Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Flavor Vote">
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote1" id="flavor_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_flavor_vote" id="mystery_flavor_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_flavor_vote10" id="flavor_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col text-start">
            <label class="ps-2 modal-info-shadow" for="flavor_1_point">Bad<span class="long-voting-label"> or </span>No Flavor</label> 
          </div>
          <div class="col text-end">
            <label class="pe-2 modal-info-shadow" for="flavor_10_point">Tastey Flavor</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_flavor_vote"
    },
    {
      title: "{{ strain }} - Flavor Rating Explanation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_flavor_explanation" name="mystery_flavor_explanation" placeholder="Explain your Flavor Rating for {{ strain }}" aria-label="Flavor Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_flavor_explanation"
    },
    {
      title: "{{ strain }} -Smoothness of Smoke Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Smoothness Vote">
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote1" id="smoothness_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_smoothness_vote" id="mystery_smoothness_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_smoothness_vote10" id="smoothness_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col text-start">
            <label class="ps-2 modal-info-shadow long-voting-label" for="smoothness_1_point">Harsh, Causes Cough</label> 
          </div>
          <div class="col text-end">
            <label class="pe-2 modal-info-shadow long-voting-label" for="smoothness_10_point">Smooth, Relaxing</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_smoothness_vote"
    },
    {
      title: "{{ strain }} - Smoothness of Smoke Explanation",
      content: `
        <div class="container">
          <div class="row px-2 px-lg-4">
            <input class="form-control text-center" type="text" id="mystery_smoothness_explanation" name="mystery_smoothness_explanation" placeholder="Explain your 'Smooth Smoke' Rating for {{ strain }}" aria-label="Smoothness of Smoke Vote Explantion Field" />
          </div>
        </div>
      `,
      key: "mystery_smoothness_explanation"
    },
    {
      title: "{{ strain }} - Effects Rating",
      content: `
      <div class="container align-items-center text-center">
        <div class="btn-group" role="group" aria-label="Connoisseur Effects Vote">
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote1" value="1" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote1" id="effects_1_point">1</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote2" value="2" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote2">2</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote3" value="3" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote3">3</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote4" value="4" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote4">4</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote5" value="5" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote5">5</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote6" value="6" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote6">6</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote7" value="7" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote7">7</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote8" value="8" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote8">8</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote9" value="9" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote9">9</label>
        
          <input type="radio" class="btn-check" name="mystery_effects_vote" id="mystery_effects_vote10" value="10" autocomplete="off">
          <label class="btn btn-outline-dark" for="mystery_effects_vote10" id="effects_10_point">10</label>
        </div>
        <div class="row pt-1">
          <div class="col-6 text-start">
            <label class="ps-2 modal-info-shadow long-voting-label" for="effects_1_point">Short-Lived, No Effects</label> 
          </div>
          <div class="col-6 text-end">
            <label class="pe-2 modal-info-shadow long-voting-label" for="effects_10_point">Strong, Lasting Effects</label> 
          </div>
        </div>
      </div>
      `,
      key: "mystery_effects_vote"
    },
    {
      title: "{{ strain }} - Effects Rating Explanation",
      content: `
        <div class="container align-content-center align-items-center justify-content-center text-center">
          <div class="row">
            <div class="col-7">
              <label class="pb-3 ps-2 fs-5 text-start" for="mystery_effects_explanation">Please pick a minimum of two (2) to explain how {{ strain }} made you feel:</label>
            </div>
            <div class="col-5 align-content-center align-items-center justify-content-center ">
              <select class="form-select px-3 px-lg-4" id="mystery_effects_explanation" name="mystery_effects_explanation" aria-label="Effects Vote Explanation Field" multiple>
                <option value="sedative">Sedative</option>
                <option value="relaxing">Relaxing</option>
                <option value="sleepy">Sleepy</option>
                <option value="tingly">Tingly</option>
                <option value="calming">Calming</option>
                <option value="hungry">Hungry</option>
                <option value="happy">Happy</option>
                <option value="giggly">Giggly</option>
                <option value="energizing">Energizing</option>
                <option value="euphoric">Euphoric</option>
                <option value="focused">Focused</option>
                <option value="uplifting">Uplifting</option>
                <option value="alert">Alert</option>
                <option value="creative">Creative</option>
                <option value="talkative">Talkative</option>
                <option value="aroused">Aroused</option>
                <option value="aroused">None / Short Lived</option>
              </select>
            </div>
          </div>
        </div>
      `,
      key: "mystery_effects_explanation"
    },
  ];
  function adjustButtonSize() {
    if (window.matchMedia("(max-width: 767px)").matches) {
      const elements = document.querySelectorAll('.btn-group-lg');
      elements.forEach(element => {
        element.classList.remove('btn-group-lg');
      });
      const classLabels = document.querySelectorAll('.consume-label');
      classLabels.forEach(label => {
        label.classList.remove('fs-5');
        label.classList.add('fs-6');
      });
      const formElements = document.querySelectorAll('.form-select-lg');
      formElements.forEach(element => {
        element.classList.remove('form-select-lg');
      });
      const inputElements = document.querySelectorAll('.form-control-lg');
      inputElements.forEach(element => {
        element.classList.remove('form-control-lg');
      });
    } else {
      const elements = document.querySelectorAll('.btn-group');
      elements.forEach(element => {
        element.classList.add('btn-group-lg');
      });
      const classLabels = document.querySelectorAll('.consume-label');
      classLabels.forEach(label => {
        label.classList.add('fs-5');
        label.classList.remove('fs-6');
      });
      const formElements = document.querySelectorAll('.form-select');
      formElements.forEach(element => {
        element.classList.add('form-select-lg');
      });
      const inputElements = document.querySelectorAll('.form-control');
      inputElements.forEach(element => {
        element.classList.add('form-control-lg');
      });
    }
  }
  window.addEventListener('resize', adjustButtonSize);
  
  document.addEventListener("DOMContentLoaded", function() {
    const submitButton = document.getElementById("submitNewVoterBtn");
    const form = document.getElementById("newVoterForm");
        document.getElementById("newUserBackBtn").onclick = function() {
      $('#voterInfoCaptureModal').modal('hide');
    };
  
    submitButton.addEventListener("click", function(event) {
      event.preventDefault();
  
      const formData = new URLSearchParams();
        formData.append('voter_name', document.getElementById("voter_name").value);
        formData.append('voter_email', document.getElementById("voter_email").value);
        formData.append('voter_phone', document.getElementById("voter_phone").value);
        formData.append('voter_zip_code', document.getElementById("voter_zip_code").value);
    
        fetch("/submit-new-voter", {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded",
          },
          body: formData.toString()
        })
      .then(response => response.json())
      .then(data => {
        console.log(data.status)
        if (data.status === true) {
          $('#voterInfoCaptureModal').modal('hide');
          step = 0;
          loadQuestion();
        } else {
          return
        }
      })
      .catch(error => {
        console.error("Error:", error);
      });
    });
      
    async function checkVoterExists(email) {
      const root = window.location.origin;
      const url = new URL('/check-mystery-voter', root);
      url.searchParams.append('voter_email', email);
      
      const response = await fetch(url, {
          method: 'GET',
          headers: {
              'Content-Type': 'application/json'
          }
      });
  
      if (response.ok) {
          const data = await response.json();
          return data.exists;
      } else {
          console.log("Request failed:", response.status, response.statusText);
          return false;
      }
    }
      
    let step = 0;
    const formState = {
      "cultivator": "{{ cultivator }}",
      "strain": "{{ strain }}",
    };
    const modalTitle = document.getElementById('modalTitle');
    const modalBody = document.getElementById('modalBody');
    const nextBtn = document.getElementById('nextBtn');
    const backBtn = document.getElementById('backBtn');
    
    async function submitForm(formState) {
      try {
        const response = await fetch('/mystery_flower_review/submit-mystery-review', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formState)
        });
        console.log(response)
        if (response.ok) {
          const data = await response.json();
          console.log("Submission successful:", data);
          window.location.href = "https://cannabiscult.co/voting-home";
        } else {
          console.log("Submission failed:", response.status, response.statusText);
        }
      } catch (error) {
        console.error("Error during submission:", error);
      }
    }
  
    function loadQuestion() {
      const intKeys = [
        "mystery_sight_vote", 
        "mystery_size_vote",
        "mystery_structure_vote", 
        "mystery_smell_vote",
        "mystery_freshness_vote",
        "mystery_flavor_vote",
        "mystery_effects_vote",
        "mystery_smoothness_vote",
      ];
      
      if (step < 0) {
        step = 0;
      }
      if (step < questions.length) {
        const question = questions[step];
        modalTitle.innerHTML = question.title;
        modalBody.innerHTML = question.content;
        
    
        const input = document.getElementById(question.key);
        
        document.addEventListener('keydown', function enterKeyHandler(event) {
          if (event.keyCode === 13) {
            event.preventDefault();
            nextBtn.click();
          }
        });
    
        nextBtn.onclick = async function () {
          if (input) {
            var inputVal = input.value;
              
            if (question.key === "voter_email") {
              const voterExists = await checkVoterExists(input.value);
              if (!voterExists) {
                $('#voterInfoCaptureModal').modal('show');
                return;
              }
              formState[question.key] = input.value;
            }
            else if (question.key === "mystery_effects_explanation") {
              const selectedOptions = Array.from(document.getElementById('mystery_effects_explanation').selectedOptions).map(option => option.value);
              if (selectedOptions.length <= 1) {
                alert("Please tell us two ways {{ strain }} made you feel. On desktop you will need to hold the control key to highlight multiple selections."); 
                return;
              }
              const combinedString = selectedOptions.join(' ');
              formState['mystery_effects_explanation'] = combinedString;
            } 
            else {
              formState[question.key] = input.value;
            }
          } else {
            const radioCheck = Array.from(document.getElementsByName(question.key)).find(radio => radio.checked);
            const radioVal = radioCheck ? radioCheck.value : "0";
            if (radioVal === "0") {
              alert("Connoisseur Scoring Reviews Must Have a Value!"); 
              return;
            }
            formState[question.key] = radioVal;
          }
           
          $('#voterInfoCaptureModal').on('hidden.bs.modal', function () {
            step++;
            loadQuestion();
            adjustButtonSize();
          });
    
          if (!$('#voterInfoCaptureModal').hasClass('show')) {
            step++;
            loadQuestion();
            adjustButtonSize();
          }
        };
      } else {
        nextBtn.textContent = 'Submit';
        nextBtn.onclick = function () {
          submitForm(formState);
        };
        modalTitle.textContent = 'All questions completed.';
        modalBody.textContent = '';
      }
      backBtn.onclick = function () {
        $('#voterInfoCaptureModal').modal('hide');
        
        $('#voterInfoCaptureModal').on('hidden.bs.modal', function () {
          step--;
          loadQuestion();
          adjustButtonSize();
        });
        
        if (!$('#voterInfoCaptureModal').hasClass('show')) {
          step--;
          loadQuestion();
          adjustButtonSize();
        }
      };
    }
    adjustButtonSize();
    loadQuestion();
    adjustButtonSize();
  });
</script>
{% endblock %}